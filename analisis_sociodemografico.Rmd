Row
-----------------------------------------------------------------


### <b style="font-size: 22px;">Distribución de Edad por Género</b>

```{r, echo=FALSE, results='asis'}
cat('<div style="position: relative;">')
```
```{r setup-sociodemografico, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(scales)
library(knitr)
library(kableExtra)

# Recodificar a español y ordenar los niveles de cada variable
datos_estudiantes <- datos_estudiantes |>
  mutate(
    Relationship_Status = recode(Relationship_Status,
      "Single"          = "Soltero/a",
      "In Relationship" = "En relación",
      "Complicated"     = "Complicado"
    ),
    Academic_Level = recode(Academic_Level,
      "High School"    = "Secundaria",
      "Undergraduate"  = "Pregrado",
      "Graduate"       = "Posgrado"
    ),
    Relationship_Status = factor(Relationship_Status,
      levels = c("Soltero/a", "En relación", "Complicado")),
    Academic_Level = factor(Academic_Level,
      levels = c("Secundaria", "Pregrado", "Posgrado"))
  )
```
```{r, echo=FALSE, results='asis'}
cat('</div>')
```

La pirámide poblacional muestra la distribución de edades de los estudiantes encuestados según su género. Este tipo de gráfico permite visualizar la estructura demográfica de la muestra, identificando patrones en la composición por edad y género.

```{r, echo=FALSE, results='asis'}
cat('<div style="position: relative;">')
```
```{r piramide-poblacional, echo=FALSE, fig.height=7, fig.align='center', message=FALSE, warning=FALSE}
# Crear etiquetas con conteos
datos_con_etiquetas <- datos_estudiantes %>%
  group_by(Gender) %>%
  mutate(Gender_Label = paste0(Gender, " (", n(), ")")) %>%
  ungroup()

# Pirámide de población con intervalos de 1 año y colores pasteles
ggplot(datos_con_etiquetas, aes(x = Age, fill = Gender_Label)) +
  geom_histogram(data = subset(datos_con_etiquetas, Gender == "Female"),
                 aes(y = after_stat(count), fill = Gender_Label),
                 binwidth = 1, alpha = 0.8, color = "black", linewidth = 0.5) +
  geom_histogram(data = subset(datos_con_etiquetas, Gender == "Male"),
                 aes(y = -after_stat(count), fill = Gender_Label),
                 binwidth = 1, alpha = 0.8, color = "black", linewidth = 0.5) +
  coord_flip() +
  scale_fill_manual(values = c("Female (353)" = "#FFB3D9", "Male (352)" = "#B3D9FF")) +
  scale_y_continuous(labels = abs, name = "Frecuencia") +
  labs(x = "Edad",
       fill = "Género") +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
        plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray40"),
        legend.position = "top",
        panel.grid.minor = element_blank(),
        panel.grid.major.y = element_line(color = "gray90"))
```
```{r, echo=FALSE, results='asis'}
cat('</div>')
```

La pirámide muestra una distribución casi equitativa entre géneros, con **353 mujeres** y **352 hombres**. La mayoría de los estudiantes se encuentran en el rango de edad entre 18 y 24 años, típico de estudiantes universitarios. Se observa una concentración particularmente alta alrededor de los 19-21 años, que corresponde a estudiantes de pregrado.

Row
-----------------------------------------------------------------

### <b style="font-size: 22px;">Estado Civil por Nivel Académico</b>

La tabla presenta para cada nivel académico los porcentajes de estudiantes en cada estado civil. Hay una gran frecuencia en los niveles académicos superiores como el pregrado y el posgrado en comparación de secundaria. Se destaca que una pequeña parte de la población tiene secundaria como nivel académico y se encuentra en un estado civil complicado.

```{r, echo=FALSE, results='asis'}
cat('<div style="position: relative;">')
```
```{r setup-tabla-cruzada, echo=FALSE, message=FALSE, warning=FALSE}
# Tabla cruzada
tabla_cruzada <- table(datos_estudiantes$Academic_Level,
                       datos_estudiantes$Relationship_Status)
```
```{r, echo=FALSE, results='asis'}
cat('</div>')
```

```{r, echo=FALSE, results='asis'}
cat('<div style="position: relative;">')
```
```{r tabla-cruzada-estado-civil, echo=FALSE, message=FALSE, warning=FALSE}
# Porcentajes por nivel académico (fila)
tabla_porcentajes <- prop.table(tabla_cruzada, margin = 1) * 100

# Data frame horizontal
tabla_horizontal <- data.frame(
  Nivel_academico = rownames(tabla_cruzada),
  Soltero_Freq    = tabla_cruzada[, "Soltero/a"],
  Soltero_Pct     = paste0(round(tabla_porcentajes[, "Soltero/a"], 1), "%"),
  EnRel_Freq      = tabla_cruzada[, "En relación"],
  EnRel_Pct       = paste0(round(tabla_porcentajes[, "En relación"], 1), "%"),
  Comp_Freq       = tabla_cruzada[, "Complicado"],
  Comp_Pct        = paste0(round(tabla_porcentajes[, "Complicado"], 1), "%"),
  Total           = rowSums(tabla_cruzada)
)

kable(tabla_horizontal,
      col.names = c("Nivel académico",
                    "Frecuencia", "%",
                    "Frecuencia", "%",
                    "Frecuencia", "%",
                    "Total"),
      align = c("l", "c", "c", "c", "c", "c", "c", "c"),
      row.names = FALSE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
                full_width = TRUE,
                font_size = 11) %>%
  add_header_above(c(" "          = 1,
                     "Soltero/a"  = 2,
                     "En relación"= 2,
                     "Complicado" = 2,
                     " "          = 1))
```
```{r, echo=FALSE, results='asis'}
cat('</div>')
```


<br>

De manera homóloga, el gráfico muestra la distribución de estudiantes según su estado civil de acuerdo al nivel académico que cada uno de ellos tiene. Con él, se puede destacar que dentro de la población prima el estado civil soltero/a frente al resto.
```{r, echo=FALSE, results='asis'}
cat('<div style="position: relative;">')
```
```{r grafico-estado-academico, echo=FALSE, fig.height=4, fig.align='center', message=FALSE, warning=FALSE}
# Datos para el gráfico
datos_grafico <- as.data.frame(tabla_cruzada)
colnames(datos_grafico) <- c("Nivel_academico", "Estado_civil", "Frecuencia")

# Gráfico de barras apiladas al 100%
ggplot(datos_grafico,
       aes(x = Nivel_academico, y = Frecuencia, fill = Estado_civil)) +
  geom_bar(stat = "identity", position = "fill") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(title = "Distribución del estado civil por nivel académico (%)",
       x = "Nivel académico",
       y = "Porcentaje de estudiantes",
       fill = "Estado civil") +
  theme_minimal() +
  theme(axis.text.x  = element_text(angle = 0, hjust = 0.5, size = 10),
        plot.title   = element_text(hjust = 0.5, face = "bold", size = 13),
        legend.position = "bottom")
```
```{r, echo=FALSE, results='asis'}
cat('</div>')
```